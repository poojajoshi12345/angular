<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Diagram Test</title>
		<meta http-equiv="X-UA-Compatible" content="IE=11">
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<meta name="google" value="notranslate">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script type="text/javascript" src="../../resources/ibx.js"></script>
		<script type="text/javascript">
			ibx(function(e) {

				var canvas = $('.test-canvas').ibxDiagram('instance');
				var offset = 250, count = 3;

				$('.btnSelectMode').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					$('.test-canvas').ibxWidget('option', 'selectMode', checked ? 'fit' : 'touch');
				});


				$('.btnGrid').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					var grid = checked ? {size: 150, offset: {left: 25, top: 25}} : {size: null, offset: {left: 0, top: 0}};
					$('.test-canvas').ibxWidget('option', 'grid', grid);
				});

				$('.btnAddNode').on('click', function(e) {
					canvas.add({
						left: offset, top: offset, width: 100, height: 100,
						className: 'layout-item', text: 'Item ' + (count++)
					})
					offset += 120;
				});

				var json;
				$('.btnMoveable').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					$('#firstNode').ibxDiagramNode('option', 'moveable', checked);
				});

				$('.btnSelectable').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					$('.btnDeletable').toggleClass('invisible', !checked);
					$('#firstNode').ibxDiagramNode('option', 'selectable', checked);
				});

				$('.btnDeletable').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					$('#firstNode').ibxDiagramNode('option', 'deletable', checked);
				});

				$('.drag-item').on('ibx_dragstart', function(e) {
					 e.originalEvent.dataTransfer.setData("nodeId", this.id);
				});

				$('#hoverAnchor').on('ibx_dragover', function() {
					$(this).addClass('anchorHoverEffect');
				}).on('ibx_dragleave ibx_drop', function() {
					$(this).removeClass('anchorHoverEffect');
				})

				var n1 = canvas.add({
					left: 20, top: 170, width: 100, height: 100,
					className: 'layout-item',
					text: 'Item 1<br>Right click for Menu',
					ctxMenu: '.ctx-menu',
					annotations: [{className: 'anchor round', width: 15, height: 15, position: 'right'}]
				});

				var n2 = canvas.add({
					left: 220, top: 20, width: 100, height: 100,
					className: 'layout-item', text: 'Item 2',
					annotations: [
						{className: 'anchorSymbol fa fa-adjust', width: 20, height: 20, position: 'left'},
						{className: 'anchorSymbol fa fa-plus-circle', width: 20, height: 20, position: 'right'}
					]
				});

				canvas.addConnection({
					from: {node: 0, anchor: 'right', tip: {shape: 'arrow-hollow', size: 8}},
					to: {node: n2, anchor: 'left'}
				});

				canvas.addConnection({
					from: {node: n1, anchor: 'left'},
					to: {node: n2, anchor: 'right'}
				});

				canvas.addConnection({
					className: 'stylish-connection',
					from: {node: n2, anchor: 'right', tip: {shape: 'arrow', size: 20}},
					to: {node: 1, anchor: 'left', tip: {shape: 'arrow-hollow', size: 10}}
				});

				canvas.add($('<div style="left: 200px; top: 400px; width: 50px; height: 50px" class="layout-item">'));  // canvas should ignore this non-diagram-node node

				canvas.add($('<div style="left: 20px; top: 400px; width: 50px; height: 50px" class="layout-item" data-ibx-type="ibxDiagramNode">'));  // TODO: Should this work?  It doesn't

			}, [{"src" : "./diagram_res_bundle.xml", "loadContext" : "app"}], true);
		</script>
		<style type="text/css">
			html, body {
				width: 100%;
				height: 100%;
				margin: 0px;
				padding: 10px;
				box-sizing: border-box;
			}
			.test-canvas {
				width: 800px;
				height: 500px;
				border: 1px solid black;
			}
			.layout-item {
				width: 75px;
				height: 75px;
				background-color: #eee;
				border: 1px solid black;
			}
			.item-2 {
				right: 10px;
				top: 10px;
				width: 100px;
				height: 100px;
			}
			.test-connection {
				border: 1px solid red;
			}

			.anchor {
				background-color: white;
				border: 1px solid black;
			}

			.round {
				border-radius: 10px;
			}

			.anchorSymbol {
				background-color: white;
				border-radius: 20px;
				font-size: 20px;
				color: #444
			}

			.anchorHoverEffect {
				background-color: red;
			}

			.btn {
				margin: 10px;
			}

			.invisible {
				visibility: hidden;
			}

			.stylish-connection {
				stroke: #0280bb;
				stroke-width: 4px;
				fill: #0280bb;
			}

			.node-holder {
				border: 1px solid black;
				position: relative;
				max-width: 130px;
				padding: 10px;
				margin-top: 77px;
			}

			.arrow-separator {
				margin: 15px;
			}

			.drag-item {
				position: absolute;
				left: 37px;
			}

		</style>
	</head>
	<body class="ibx-root">
		<div class="box-content" data-ibx-type="ibxHBox" data-ibxp-align="stretch">

			<div class="node-holder">
				<div>Drag these nodes from here and drop them on the canvas on the right.</div>
				<div id="dragNode1" class="layout-item drag-item" style="top: 70px;"  data-ibx-type="ibxLabel" data-ibxp-draggable="true">Drag Me 1</div>
				<div id="dragNode2" class="layout-item drag-item" style="top: 180px;" data-ibx-type="ibxLabel" data-ibxp-draggable="true">Drag Me 2</div>
				<div id="dragNode3" class="layout-item drag-item" style="top: 290px;" data-ibx-type="ibxLabel" data-ibxp-draggable="true">Drag Me 3</div>
				<div id="dragNode4" class="layout-item drag-item" style="top: 400px;" data-ibx-type="ibxLabel" data-ibxp-draggable="true">Drag Me 4</div>
			</div>

			<div class="arrow-separator" data-ibx-type="ibxLabel" data-ibxp-glyph-classes="ibx-icons ibx-36 ibx-glyph-arrow-right"></div>

			<div>
				<div class="buttons">
					<div class="btnSelectMode btn" data-ibx-type="ibxCheckBoxSimple">Lasso entire node to Select</div>
					<div class="btnGrid btn" data-ibx-type="ibxCheckBoxSimple">Lock to Grid</div>
					<div class="btnAddNode btn" data-ibx-type="ibxButton">Add Node</div>
				</div>
				<div class="buttons">
					<div data-ibx-type="ibxLabel">First Node is</div>
					<div class="btnSelectable btn" data-ibx-type="ibxCheckBoxSimple">Selectable</div>
					<div class="btnMoveable btn" data-ibx-type="ibxCheckBoxSimple">Moveable</div>
					<div class="btnDeletable btn invisible" data-ibx-type="ibxCheckBoxSimple">Deletable</div>
				</div>

				<!-- <div class="test-canvas" data-ibx-type="ibxDiagram" data-ibx-options="{grid: {size: 150, offset: {left: 25, top: 25}}}"> -->
				<div
					class="test-canvas"
					data-ibx-type="ibxDiagram"
					data-ibxp-external-drop-target="true"
					data-ibx-options="{selectMode: 'fit'}"
				>
					<div
						id="firstNode"
						class="layout-item"
						data-ibx-type="ibxDiagramNode"
						data-ibx-options="{left: 20, top: 20, width: 100, height: 100, moveable: false, deletable: false, selectable: false}"
					>
						Layout Item 1
						<div
							data-ibx-type="ibxDiagramAnnotation"
							data-ibx-options="{position: 'right', width: 30, height: 30}"
							class="anchor round"
						>
						</div>
					</div>
					<div
						class="layout-item item-2"
						data-ibx-type="ibxDiagramNode"
						data-ibxp-ctx-menu=".ctx-menu"
					>
						Layout Item 2<br>Right click for Menu
					</div>
					<div
						id="connectionNode"
						class="layout-item"
						data-ibx-type="ibxDiagramNode"
						data-ibx-options="{left: 550, top: 170, width: 100, height: 100}"
					>
						Drop node on this anchor to connect
						<div
							id="hoverAnchor"
							data-ibx-type="ibxDiagramAnnotation"
							data-ibx-options="{position: 'left', width: 20, height: 20, drop: 'connect'}"
							class="anchor"
						>
						</div>
					</div>
					<div>Canvas should *not* convert this element into a canvas node</div>
				</div>
				<div class="ctx-menu" data-ibx-type="ibxMenu">
					<div data-ibx-type="ibxMenuItem">Menu Item 1</div>
					<div data-ibx-type="ibxMenuItem">Menu Item 2</div>
					<div data-ibx-type="ibxMenuItem">Menu Item 3</div>
				</div>
			</div>
		</div>
	</body>
</html>
