<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Diagram Test</title>
		<meta http-equiv="X-UA-Compatible" content="IE=11">
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<meta name="google" value="notranslate">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script type="text/javascript" src="../../resources/ibx.js"></script>
		<script type="text/javascript">
			ibx(function(e) {

				var canvas = $('.test-canvas').ibxDiagram('instance');
				var offset = 250, count = 3;

				$('.btnSelectMode').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					$('.test-canvas').ibxWidget('option', 'selectMode', checked ? 'fit' : 'touch');
				});


				$('.btnGrid').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					var grid = checked ? {size: 150, offset: {left: 25, top: 25}} : {size: null, offset: {left: 0, top: 0}};
					$('.test-canvas').ibxWidget('option', 'grid', grid);
				});

				$('.btnAddNode').on('click', function(e) {
					canvas.addNode({
						left: offset, top: offset, width: 100, height: 100,
						className: 'layout-item', text: 'Item ' + (count++)
					})
					offset += 120;
				});

				var json;
				$('.btnSave').on('click', function(e) {
					json = canvas.saveToJSON();
					$('.btnLoad').removeClass('invisible');
				});

				$('.btnLoad').on('click', function(e) {
					if (json) {
						canvas2.clear();
						canvas2.loadFromJSON(json);
					}
				});

				$('.btnMoveable').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					$('#firstNode').ibxDiagramNode('option', 'moveable', checked);
				});

				$('.btnSelectable').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					$('.btnDeletable').toggleClass('invisible', !checked);
					$('#firstNode').ibxDiagramNode('option', 'selectable', checked);
				});

				$('.btnDeletable').on('ibx_change', function(e) {
					var checked = $(e.target).ibxWidget('checked');
					$('#firstNode').ibxDiagramNode('option', 'deletable', checked);
				});

				var n1 = canvas.addNode({
					left: 20, top: 170, width: 100, height: 100,
					className: 'layout-item', text: 'Item 1',
					anchors: {
						right: {className: 'anchor', width: 15, height: 15}
					}
				});

				var n2 = canvas.addNode({
					left: 220, top: 20, width: 100, height: 100,
					className: 'layout-item', text: 'Item 2',
					anchors: {
						left: {
							className: 'anchorSymbol fa fa-adjust',
							width: 20, height: 20
						},
						right: {
							className: 'anchorSymbol fa fa-plus-circle',
							width: 20, height: 20
							
						}
					}
				});

				canvas.addConnection({
					from: {node: 0, anchor: 'left'},
					to: {node: n2, anchor: 'right'}
				});

				canvas.addConnection({
					from: {node: n1, anchor: 'left'},
					to: {node: n2, anchor: 'right'}
				});

				canvas.addConnection({
					className: 'stylishConnection',
					from: {node: n2, anchor: 'right', tip: {shape: 'arrow', size: 20}},
					to: {node: 1, anchor: 'left', tip: {shape: 'arrow-hollow', size: 10}}
				});

				canvas.addNode($('<div style="left: 20px; top: 400px; width: 50px; height: 50px" class="layout-item">'));

				var canvas2 = $('.test-canvas2').ibxDiagram('instance');

			}, [{"src" : "./diagram_res_bundle.xml", "loadContext" : "app"}], true);
		</script>
		<style type="text/css">
			html, body {
				width: 100%;
				height: 100%;
				margin: 0px;
				padding: 10px;
				box-sizing: border-box;
			}
			.test-canvas {
				width: 800px;
				height: 600px;
				border: 1px solid black;
			}
			.test-canvas2 {
				border: 1px solid black;
			}
			.layout-item {
				width: 75px;
				height: 75px;
				background-color: #eee;
				border: 1px solid black;
			}
			.item-1 {
			}
			.item-2 {
				right: 10px;
				top: 10px;
				width: 100px;
				height: 100px;
			}
			.test-connection {
				border: 1px solid red;
			}

			.anchor {
				background-color: white;
				border: 1px solid black;
				border-radius: 10px;
			}

			.anchorSymbol {
				background-color: white;
				border-radius: 20px;
				font-size: 20px;
				color: #444
			}

			.anchor-right {
				position: absolute;
				left: 95px;
				top: 45px;
				width: 10px;
				height: 10px;
			}

			.btn {
				margin: 10px;
			}

			.invisible {
				visibility: hidden;
			}

			.stylishConnection {
				stroke: #0280bb;
				stroke-width: 4px;
				fill: #0280bb;
			}

		</style>
	</head>
	<body class="ibx-root">
		<div class="buttons">
			<div class="btnSelectMode btn" data-ibx-type="ibxCheckBoxSimple">Lasso entire node to Select</div>
			<div class="btnGrid btn" data-ibx-type="ibxCheckBoxSimple">Lock to Grid</div>
			<div class="btnAddNode btn" data-ibx-type="ibxButton">Add Node</div>
			<div class="btnSave btn" data-ibx-type="ibxButton">Save as JSON</div>
			<div class="btnLoad btn invisible" data-ibx-type="ibxButton">Load JSON to 2nd Canvas</div>
		</div>
		<div class="buttons">
			<div data-ibx-type="ibxLabel">First Node is</div>
			<div class="btnMoveable btn" data-ibx-type="ibxCheckBoxSimple">Moveable</div>
			<div class="btnSelectable btn" data-ibx-type="ibxCheckBoxSimple">Selectable</div>
			<div class="btnDeletable btn invisible" data-ibx-type="ibxCheckBoxSimple">Deletable</div>
		</div>
		<!-- <div class="test-canvas" data-ibx-type="ibxDiagram" data-ibx-options="{grid: {size: 150, offset: {left: 25, top: 25}}}"> -->
		<div class="test-canvas" data-ibx-type="ibxDiagram" data-ibx-options="{selectMode: 'touch'}">
			<div
				id="firstNode"
				class="layout-item item-1"
				data-ibx-type="ibxDiagramNode"
				data-ibx-options="{left: 20, top: 20, width: 100, height: 100, moveable: false, deletable: false, selectable: false}"
			>
				Layout Item 1
				<div
					class="anchor-right anchor"
				>
				</div>
			</div>
			<div
				class="layout-item item-2"
				data-ibx-type="ibxDiagramNode"
			>
				Layout Item 2
			</div>
		</div>
		<div class="test-canvas2" data-ibx-type="ibxDiagram">
		</div>
	</body>
</html>
