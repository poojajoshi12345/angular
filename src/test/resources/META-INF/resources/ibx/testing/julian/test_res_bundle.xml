<?xml version="1.0" encoding="UTF-8"?>
<ibx-res-bundle name="test_res_bundle.xml" loadContext="bundle">
	<strings>
		<string-file src="./test_res_strings.txt" default="false"/>
		<string-bundle>
			<![CDATA[
			{
				"language":"ibx_default",
				"strings":
				{
				}
			}
		]]>
		</string-bundle>
	</strings>

	<styles>
		<style-file src="./test_res_styles.css"/>
		<style-sheet>
		<![CDATA[
			.date-label
			{
				margin-right:2px;
			}
			.date-value
			{
				border:1px solid #ccc;
				padding:2px;
				margin-right:2px;
			}
			.date-button
			{
				font-size:1.5em;
			}
		]]>
		</style-sheet>
	</styles>

	<markup>
		<markup-file src="./test_res_markup.xml"/>
		<markup-block>
		</markup-block>
	</markup>

	<scripts>
		<script-file src="./test_res_script.js"/>
		<script-file src="../../ibxtools/shared_resources/js/ibfs.js" loadContext="ibx"/>
		<script-block>
		<![CDATA[
			$.widget("ibi.ibxDateRange", $.ibi.ibxFlexBox, 
			{
				options:
				{
					align:"center",
					dateOptions:
					{
						"type":"inline",
						"changeYear":true,
						"changeMonth":true,
					}
				},
				_widgetClass:"ibx-date-range",
				_create:function()
				{
					this._super();
					var dateBox = this.dateFromBox = $("<div class='date-box date-box-from'>").ibxFlexBox({align:"center"})
					var dateLabel = this.dateFromLabel = $("<div class='date-label date-from-label'>From:</div>").ibxLabel();
					var dateValue = this.dateFromValue = $("<div tabindex='0' class='date-value date-from-value'>00/00/0000</div>").ibxLabel();
					var dateButton = this.dateFromButton = $("<div tabindex='0' class='date-button date-from-button'>").ibxButtonSimple({glyphClasses:"fa fa-calendar"});
					dateBox.append(dateLabel, dateValue, dateButton);

					var dateBox = this.dateToBox = $("<div class='date-box date-box-to'>").ibxFlexBox({align:"center"})
					var dateLabel = this.dateToLabel = $("<div class='date-label date-to-label'>To:</div>").ibxLabel();
					var dateValue = this.dateToValue = $("<div tabindex='0' class='date-value date-to-value'>00/00/0000</div>").ibxLabel();
					var dateButton = this.dateToButton = $("<div tabindex='0' class='date-button date-to-button'>").ibxButtonSimple({glyphClasses:"fa fa-calendar"});
					dateBox.append(dateLabel, dateValue, dateButton);

					$([this.dateFromButton[0], this.dateToButton[0]]).on("click", this._onDateBtnClick.bind(this));


					this.element.append(this.dateFromBox, this.dateToBox);
				},
				_init:function()
				{
					this._super();
				},
				_destroy:function()
				{
					this._super();
				},
				_onDateBtnClick:function(e)
				{
					var btn = $(e.currentTarget);
					var cal = $("<div>").ibxDatePicker(this.options.dateOptions).on("ibx_change", this._onDateChange.bind(this)).data("triggerButton", btn);
					var popup = $("<div>").ibxPopup({position:{my:"left top", at:"left bottom", of:btn.closest(".date-box"), collision:"fit flip"}});
					popup.append(cal).ibxWidget("open");
				},
				_onDateChange:function(e, data)
				{
					var datePicker = $(e.target);
					var btn = datePicker.data("triggerButton");
					var value = btn.siblings(".date-value");
					value.ibxWidget("option", "text", data.date);
				},
				_refresh:function()
				{
					var options = this.options;
					this._super();
				}
			});
			//# sourceURL=test_res_bundle.xml
		]]>
		</script-block>
	</scripts>
</ibx-res-bundle>