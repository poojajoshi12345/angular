<!--Copyright (c) 1996-2021 TIBCO Software Inc. All Rights Reserved. -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>ibx grid sample</title>
		<meta http-equiv="X-UA-Compatible" content="IE=EDGE" >
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<Script src="../../../resources/ibx.js" type="text/javascript"></script>
		<script type="text/javascript">
			ibx(function()
			{
				var gridTabs = ibx.resourceMgr.getResource(".grid-tabs").data("ibxWidget");
				$("body").append(gridTabs.element);

				// var mql = MediaQuery.addQuery("grid_sample", "(max-width: 550px)")
				// mql.addListener(function(e)
				// {
				// 	var grid = $(".test-grid");
				// 	var colCount = grid.ibxWidget("getColumnCount");
				// 	for(var i = 2; i < colCount; ++i)
				// 		grid.ibxWidget("showColumn", i, !e.matches);

				// 	var colMap = grid.ibxWidget("option", "colMap");
				// 	if(colMap.length)
				// 	{
				// 		colMap[1].size = e.matches ? "flex" : "100px";
				// 		grid.ibxWidget("updateHeaders");
				// 	}
				// });

				$(".text-entry").on("ibx_widgetfocus ibx_widgetblur", function(e)
				{
					var input = $(e.target);
					if(e.type == "ibx_widgetfocus")
						input.ibxWidget("startEditing");
					else
					if(e.type == "ibx_widgetblur")
						input.ibxWidget("stopEditing");
				})

				$(".ibx-data-grid").on("ibx_gridheaderupdate", function(e)
				{
					var grid = $(".ibx-data-grid");
					var data = e.originalEvent.data;
					if(data.type == "column")
					{
						$(data.header).on("click", function(e)
						{
							grid.ibxWidget("selectColumn", data.idx, true);
						});
					}
					else
					if(data.type == "row")
					{
						$(data.header).on("click", function(e)
						{
							grid.ibxWidget("selectRow", data.idx, true);
						});
					}
				});

				$(".grid-option").on("ibx_change", function(e)
				{
					loadGrid();
				});
				$(".btn-hide-cols, .btn-hide-rows").on("click", function(e)
				{
					var grid = $(".test-grid");
					var hideCols = $(e.currentTarget).is(".btn-hide-cols");
					if(hideCols)
					{
						this._showEvenCols = !this._showEvenCols;
						var nCols = grid.ibxWidget("getColumnCount");
						for(var i = 0; i < nCols; ++i)
							grid.ibxWidget("showColumn", i, (i%2 == 0) ? this._showEvenCols : true);
					}
					else
						grid.ibxWidget("showRow", ":even", (this._showEvenRows = !this._showEvenRows))
				});
				$(".btn-load").on("click", function(e)
				{
					loadGrid();
				});

				function loadGrid()
				{
					var rows = [];
					var nRows = parseInt($(".num-rows").text(), 10);
					var nCols = parseInt($(".num-cols").text(), 10);
					for(var i = 0; i < nRows; ++i)
					{
						var cols = [];
						for(var j = 0; j < nCols; ++j)
						{
							var cell = $(sformat("<div style='user-select:none;'>Cell {1}/{2}</div>", i, j));
							cell.ibxAddClass("ibx-flexbox fbx-inline fbx-row fbx-align-items-center fbx-aligncontent-center").ibxEditable().on("dblclick", function(e)
							{
								$(e.target).ibxEditable("startEditing");
							})
							cols.push(cell[0]);
						}
						var row = $("<div>").ibxDataGridRow();
						row.append(cols)
						rows.push(row);
					}

					var grid = $(".ibx-data-grid");
					updateDataGridSettings();
					grid.ibxWidget("removeAll");
					grid.ibxWidget("addRows", rows, null, null);
				}

				function updateDataGridSettings()
				{
					var grid = $(".ibx-data-grid");
					var colMap = [];
					var nCols = parseInt($(".num-cols").text(), 10);
					for(var i = 0; i < nCols; ++i)
						colMap.push({"sortable": i%2, "title":"Column " + i, "size":"100px"});

					var grid = $(".ibx-data-grid").ibxWidget("option",
					{
						"colMap":colMap,
						"showColumnHeaders":$(".btn-col-headers").ibxWidget("checked"),
						"showRowHeaders":$(".btn-row-headers").ibxWidget("checked"),
						"selType": $(".btn-multi-select").ibxWidget("checked") ? "multi" : "single",
						"rowSelect":$(".btn-row-select").ibxWidget("checked"),
						"toggleSelection":$(".btn-toggle-select").ibxWidget("checked"),
						"defaultColConfig":{"resizable":true}
					});
				}

				gridTabs.rgCellsJustify.on("ibx_change", function(e)
				{
					rg = $(e.target);
					var value = rg.ibxWidget("userValue");
					$(".grid").ibxWidget("option", "justify", value);
				});
				gridTabs.rgCellsAlign.on("ibx_change", function(e)
				{
					rg = $(e.target);
					var value = rg.ibxWidget("userValue");
					$(".grid").ibxWidget("option", "align", value);
				});
				gridTabs.rgGridJustify.on("ibx_change", function(e)
				{
					rg = $(e.target);
					var value = rg.ibxWidget("userValue");
					$(".grid").ibxWidget("option", "justifyContent", value);
				});
				gridTabs.rgGridAlign.on("ibx_change", function(e)
				{
					rg = $(e.target);
					var value = rg.ibxWidget("userValue");
					$(".grid").ibxWidget("option", "alignContent", value);
				});	

				gridTabs.chkInline.on("ibx_change", function(e)
				{
					var checked = $(e.currentTarget).ibxWidget("checked");
					$(".grid").ibxWidget("option", "inline", checked);
				});

				var gridMenu = ibx.resourceMgr.getResource(".grid-menu").data("ibxWidget");
				gridMenu.rgSelfJustify.on("ibx_change", function(e)
				{
					rg = $(e.target);
					var value = rg.ibxWidget("userValue");
					var cell = rg.data("gridCell");
					$(cell).data("ibxJustify", value);
					$(".grid").ibxWidget("refresh");
				});
				gridMenu.rgSelfAlign.on("ibx_change", function(e)
				{
					rg = $(e.target);
					var value = rg.ibxWidget("userValue");
					var cell = rg.data("gridCell");
					$(cell).data("ibxAlign", value);
					$(".grid").ibxWidget("refresh");
				});
				$(".grid").on("ibx_ctxmenu", function(e)
				{
					gridMenu.rgSelfJustify.data("gridCell", e.target);
					gridMenu.rgSelfAlign.data("gridCell", e.target);
					e.result = gridMenu.element;
				});


				$(".flex-grid-cell").on("click", function(e)
				{
					var cell = $(e.target);
					var row = cell.data("gridRow");
					var col = cell.data("gridCol");
					alert(sformat("You clickd on - row: {1} column: {2}", row, col));
				});
			}, [{"src":"./resources/grid_res_bundle.xml", "loadContext":"app"}], true);
		</script>
		<style type="text/css">
		</style>
	</head>
	<body class="ibx-root">
	</body>
</html>
